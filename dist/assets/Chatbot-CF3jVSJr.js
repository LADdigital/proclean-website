import{r,j as e,X as P,S as _}from"./index-DiVWXwGz.js";const $="https://hook.us2.make.com/ef4ytowuiw45sn7qp1h7cstinxdkcgds",y="https://procleanautodetailing.setmore.com/book",I=/\[SHOW_BOOK_BUTTON:\s*([^\]]+)\]/,z={"Mid Size SUV/Truck Complete":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=b15ff53ba1790709e7c944d3307dd5ccd09eb932&type=service&staff=SKIP&staffSelected=false","Full Size SUV/Truck Complete":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=b4e9d667367b1fd152eb0e5077efb8fbf2c7f1df&type=service&staff=SKIP&staffSelected=false","Car/Small Truck Complete":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=0eaeb1ba0a28c6f8e2dd5247eb29abb17019e1d8&type=service&staff=SKIP&staffSelected=false","Mini Detail":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=s946e1483395536521&type=service&staff=SKIP&staffSelected=false","Car/Small Truck Interior Only":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=392a38de25ae35b788bc21134304e0b36b92eb5f&type=service&staff=SKIP&staffSelected=false","Mid Size SUV/Truck Interior Only":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=4c9fc8e62141d84f058d576f135e94975309ad4e&type=service&staff=SKIP&staffSelected=false","Full Size SUV/Truck Interior Only":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=dc7387e8caa777cbe987fb46eedb130038bd2012&type=service&staff=SKIP&staffSelected=false","Car/Small Truck Exterior Only":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=28a6eda1c7711e836f33f9b76dfb97df1775baa6&type=service&staff=SKIP&staffSelected=false","Mid Size SUV/Truck Exterior Only":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=03e29ea5fba2f4a975b931b9a1a2d4170df701c7&type=service&staff=SKIP&staffSelected=false","Large SUV/Truck Exterior Only":"https://procleanautodetailing.setmore.com/book?step=time-slot&products=47fc942f9af14961ca1439542ea8bf0182fa2c6a&type=service&staff=SKIP&staffSelected=false"};function V(t){const s=t.trim();return z[s]??y}function g({size:t="md"}){const s=t==="sm"?"w-5 h-5":t==="lg"?"w-9 h-9":"w-6 h-6";return e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}function A(t){const s=document.createElement("div");return s.innerHTML=t,s.querySelectorAll("script, iframe, object, embed, form").forEach(n=>n.remove()),s.querySelectorAll("*").forEach(n=>{Array.from(n.attributes).forEach(l=>{(l.name.startsWith("on")||l.value.includes("javascript:"))&&n.removeAttribute(l.name)})}),s.innerHTML}function D(t){let s=t.bot_message||"";const o=s.match(I),c=o!==null,n=o?V(o[1]):y;return s=s.replace(I,"").trim(),s=A(s),{content:s,showBookButton:c,bookingUrl:n}}function E(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const s=Math.random()*16|0;return(t==="x"?s:s&3|8).toString(16)})}async function H(t,s){try{const o=await fetch($,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,session_id:s})});if(!o.ok)throw new Error(`Webhook error: ${o.statusText}`);return await o.json()}catch(o){return console.error("Chatbot webhook error:",o),null}}function O({message:t,prefersReducedMotion:s}){const o=t.role==="user",c=s?"":"animate-fadeInUp";return e.jsxs("div",{className:`flex flex-col ${o?"items-end":"items-start"} ${c}`,children:[e.jsx("div",{className:`max-w-[85%] px-4 py-3 rounded-2xl ${o?"bg-white/10 backdrop-blur-sm border-r-2 border-brand-red/50 text-white":"bg-white/5 backdrop-blur-sm text-stone-200"}`,children:o?e.jsx("p",{className:"text-sm leading-relaxed",children:t.content}):e.jsx("div",{className:"text-sm leading-relaxed prose prose-invert prose-sm max-w-none",dangerouslySetInnerHTML:{__html:t.content}})}),t.showBookButton&&e.jsx("a",{href:t.bookingUrl??y,target:"_blank",rel:"noopener noreferrer",className:"mt-3 w-full sm:w-auto px-6 py-3 bg-gradient-to-r from-brand-red to-brand-orange text-white text-sm font-semibold rounded-xl hover:shadow-lg hover:shadow-red-900/30 transition-all text-center",children:"Book Now"})]})}function W({prefersReducedMotion:t}){return e.jsx("div",{className:"flex items-start",children:e.jsx("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl px-4 py-3",children:e.jsx("div",{className:"flex gap-1",children:[0,1,2].map(s=>e.jsx("div",{className:"w-2 h-2 rounded-full bg-stone-400",style:{animation:t?"none":`pulse 1.4s ease-in-out ${s*.2}s infinite`}},s))})})})}function q({isOpen:t,setIsOpen:s}){const[o,c]=r.useState([]),[n,h]=r.useState(""),[l,v]=r.useState(!1),[d,w]=r.useState(!1),[T,U]=r.useState(()=>E()),[C,k]=r.useState(!1),B=r.useRef(null),L=r.useRef(null),j=r.useRef(null),p=r.useRef(null);r.useEffect(()=>{const a=window.matchMedia("(prefers-reduced-motion: reduce)");w(a.matches);const i=u=>w(u.matches);return a.addEventListener("change",i),()=>a.removeEventListener("change",i)},[]),r.useEffect(()=>{if(t||d)return;const a=setInterval(()=>{k(!0),setTimeout(()=>k(!1),700)},2500);return()=>clearInterval(a)},[t,d]);const S=r.useCallback(()=>{p.current&&p.current.scrollIntoView({behavior:d?"auto":"smooth"})},[d]);r.useEffect(()=>{S()},[o,l,S]);const x=r.useCallback(()=>{s(!1)},[]);r.useEffect(()=>{const a=i=>{i.key==="Escape"&&t&&x()};if(t)return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[t,x]),r.useEffect(()=>{t&&(o.length===0&&U(E()),setTimeout(()=>{var a;return(a=j.current)==null?void 0:a.focus()},100))},[t,o.length]);const N=async()=>{const a=n.trim();if(!a||l)return;const i={role:"user",content:a};c(m=>[...m,i]),h(""),v(!0);const u=await H(a,T);let b;if(u&&u.bot_message){const{content:m,showBookButton:K,bookingUrl:R}=D(u);b={role:"assistant",content:m,showBookButton:K,bookingUrl:R}}else b={role:"assistant",content:"Sorry, we're having trouble connecting right now. Please call us directly at 509-454-9299."};c(m=>[...m,b]),v(!1)},M=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),N())},f=d?"":"transition-all duration-300";return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:L,onClick:()=>s(!t),"aria-label":"Open chat assistant","aria-expanded":t,className:`fixed bottom-6 right-6 z-[9999] group ${C?"animate-widget-shake":""}`,style:{touchAction:"manipulation"},children:e.jsxs("div",{className:`relative w-20 h-20 flex items-center justify-center text-white cursor-pointer
            ${f}
            ${t?"scale-95":"scale-100 hover:scale-110"}
          `,children:[e.jsx("div",{className:`absolute inset-0 rounded-full bg-gradient-to-br from-brand-red to-brand-orange opacity-0 blur-xl
              ${f}
              ${t?"opacity-70":"group-hover:opacity-50"}
            `}),e.jsx("div",{className:`absolute inset-0 rounded-full bg-gradient-to-br from-brand-red to-brand-orange border border-white/60
              ${f}
            `,style:{boxShadow:"0 8px 24px rgba(0, 0, 0, 0.25), 0 4px 12px rgba(185, 28, 28, 0.3)"}}),e.jsx("div",{className:`relative z-10 ${f}`,children:e.jsx(g,{size:"lg"})})]})}),t&&e.jsx("div",{className:"fixed inset-0 z-[9998]",onClick:x,"aria-hidden":"true"}),e.jsxs("div",{ref:B,className:`fixed z-[10000] flex flex-col bg-brand-charcoal/95 backdrop-blur-[12px] border border-white/10 shadow-2xl
          max-w-sm w-full mx-4
          ${f}
          ${t?"opacity-100 pointer-events-auto translate-y-0 lg:translate-x-0":"opacity-0 pointer-events-none max-lg:translate-y-full lg:translate-x-full"}
          lg:bottom-28 lg:right-6 lg:rounded-2xl lg:h-[600px]
          max-lg:bottom-0 max-lg:left-0 max-lg:right-0 max-lg:mx-0 max-lg:rounded-t-3xl max-lg:h-[82svh]
        `,style:{paddingBottom:"env(safe-area-inset-bottom, 0px)",maxHeight:"calc(100svh - 48px)"},role:"dialog","aria-modal":"true","aria-labelledby":"chatbot-title",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-9 h-9 rounded-full bg-gradient-to-r from-brand-red to-brand-orange text-white",children:e.jsx(g,{})}),e.jsxs("div",{children:[e.jsx("h2",{id:"chatbot-title",className:"text-sm sm:text-base font-semibold text-white",children:"Pro Clean Assistant"}),e.jsx("p",{className:"text-xs text-stone-400",children:"Here to help"})]})]}),e.jsx("button",{onClick:x,"aria-label":"Close chat",className:"p-2 text-stone-400 hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-brand-red rounded-lg",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[o.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-r from-brand-red to-brand-orange flex items-center justify-center mb-4",children:e.jsx(g,{})}),e.jsx("h3",{className:"text-white font-semibold mb-2",children:"Welcome!"}),e.jsx("p",{className:"text-stone-400 text-sm leading-relaxed",children:"Ask us about our detailing services, pricing, or business."})]}),o.map((a,i)=>e.jsx(O,{message:a,prefersReducedMotion:d},i)),l&&e.jsx(W,{prefersReducedMotion:d}),e.jsx("div",{ref:p})]}),e.jsxs("div",{className:"p-4 border-t border-white/10",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:j,type:"text",value:n,onChange:a=>h(a.target.value),onKeyDown:M,placeholder:"Type your message...",disabled:l,className:"flex-1 px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-stone-500 focus:outline-none focus:border-brand-red/50 focus:ring-1 focus:ring-brand-red/30 text-sm disabled:opacity-50","aria-label":"Chat message input"}),e.jsx("button",{onClick:N,disabled:l||!n.trim(),className:"px-4 py-3 bg-gradient-to-r from-brand-red to-brand-orange text-white rounded-xl hover:shadow-lg hover:shadow-red-900/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Send message",children:e.jsx(_,{className:"w-5 h-5"})})]}),e.jsxs("p",{className:"text-xs text-stone-500 text-center mt-2",children:["Powered by ",e.jsx("a",{href:"https://laddigitalofyakima.com",target:"_blank",rel:"noopener noreferrer",className:"text-stone-400 hover:text-white transition-colors underline",children:"LAD Digital"})]})]})]}),e.jsx("style",{children:`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(8px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .animate-fadeInUp {
          animation: fadeInUp 0.2s ease-out;
        }

        @keyframes pulse {
          0%, 80%, 100% {
            opacity: 0.4;
            transform: scale(0.8);
          }
          40% {
            opacity: 1;
            transform: scale(1);
          }
        }

        @media (prefers-reduced-motion: reduce) {
          .animate-fadeInUp {
            animation: none;
          }
        }
      `})]})}export{q as default};
